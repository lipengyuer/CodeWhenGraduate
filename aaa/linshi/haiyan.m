% Version 1.000
%
% Code provided by Ruslan Salakhutdinov and Geoff Hinton
%
% Permission is granted for anyone to copy, use, modify, or distribute this
% program and accompanying programs and documents for any purpose, provided
% this copyright notice is retained and prominently displayed, along with
% a note saying that the original programs are available from our
% web page.
% The programs and documents are distributed without any warranty, express or
% implied.  As the programs were written for research purposes only, they have
% not been tested to the degree that would be advisable in any important
% application.  All use of these programs is entirely at the user's own risk.

% This program reads raw MNIST files available at 
% http://yann.lecun.com/exdb/mnist/ 
% and converts them to files in matlab format 
% Before using this program you first need to download files:
% train-images-idx3-ubyte.gz train-labels-idx1-ubyte.gz 
% t10k-images-idx3-ubyte.gz t10k-labels-idx1-ubyte.gz
% and gunzip them. You need to allocate some space for this.  

% This program was originally written by Yee Whye Teh 

% Work with test files first 
fprintf(1,'You first need to download files:\n train-images-idx3-ubyte.gz\n train-labels-idx1-ubyte.gz\n t10k-images-idx3-ubyte.gz\n t10k-labels-idx1-ubyte.gz\n from http://yann.lecun.com/exdb/mnist/\n and gunzip them \n'); 

f = fopen('t10k-images-idx3-ubyte','r');%一读取方式打开，存在f中
[a,count] = fread(f,4,'int32');%将f中的信息以精度int32存储在a中，cout记录数字的个数。?"4"指什么？《-读取（前四个）4个数据构成列向量，存到a。a，l，acount都没使用，应该是用来检验是否转化成功（失败的话fread时会报错）
  
g = fopen('t10k-labels-idx1-ubyte','r');
[l,count] = fread(g,2,'int32');

fprintf(1,'Starting to convert Test MNIST images (prints 10 dots) \n'); %开始转换MNIST图像，并打印10个点（进度条）
n = 1000;%test mnist有1000张图片（存疑）;%60份任务，每一份里有1000个例子

Df = cell(1,10);%可以存储任何类型数据的矩阵
for d=0:9,
  Df{d+1} = fopen(['test' num2str(d) '.ascii'],'w');%“w”表示打开后写入数据；打开test0.ascii到test9.ascii分别存到Df各位置（cell也可以以三维存储数据）
end;
  
for i=1:10,%为什么重复十次？？？分十批，将10000个样本的数据存到rawlables中
  fprintf('.');%进度条
  rawimages = fread(f,28*28*n,'uchar');%读取f中28*28*n个数据到rawimages，精度是8位无符号字符
  rawlabels = fread(g,n,'uchar');%读取f中n个数据到rawlables，精度是8位无符号字符（这里是n个图片对应的十进制数字）
  rawimages = reshape(rawimages,28*28,n);%将rawimages矩阵形状改变为28*28行，n列（读旧矩阵时是一行行，写时是一列列）

  for j=1:n,
    fprintf(Df{rawlabels(j)+1},'%3d ',rawimages(:,j));%将rawimages的第j列存储到Df的第（rawlabels(j)+1）个位置（rawlables存储的是0-9，故加1用来表示矩阵位置）
    fprintf(Df{rawlabels(j)+1},'\n');%再给写一个换行符；一行又一行的写进.
  end;
end;

fprintf(1,'\n');
for d=0:9,
  fclose(Df{d+1});%关闭Df{d+1}，停止可写状态
  D = load(['test' num2str(d) '.ascii'],'-ascii');%将test' num2str(d) '.ascii以ascii格式读到D中
  fprintf('%5d Digits of class %d\n',size(D,1),d);
  save(['test' num2str(d) '.mat'],'D','-mat');%将D中信息存储为到mat文件中
end;


% Work with trainig files second  
f = fopen('train-images-idx3-ubyte','r');
[a,count] = fread(f,4,'int32');

g = fopen('train-labels-idx1-ubyte','r');
[l,count] = fread(g,2,'int32');

fprintf(1,'Starting to convert Training MNIST images (prints 60 dots)\n'); 
n = 1000;

Df = cell(1,10);
for d=0:9,
  Df{d+1} = fopen(['digit' num2str(d) '.ascii'],'w');
end;

for i=1:60,%why 60？？？
  fprintf('.');
  rawimages = fread(f,28*28*n,'uchar');
  rawlabels = fread(g,n,'uchar');
  rawimages = reshape(rawimages,28*28,n);

  for j=1:n,
    fprintf(Df{rawlabels(j)+1},'%3d ',rawimages(:,j));
    fprintf(Df{rawlabels(j)+1},'\n');
  end;
end;

fprintf(1,'\n');
for d=0:9,
  fclose(Df{d+1});
  D = load(['digit' num2str(d) '.ascii'],'-ascii');
  fprintf('%5d Digits of class %d\n',size(D,1),d);
  save(['digit' num2str(d) '.mat'],'D','-mat');%digit0存储的是数字0对应的所有数据信息
end;

dos('rm *.ascii');
